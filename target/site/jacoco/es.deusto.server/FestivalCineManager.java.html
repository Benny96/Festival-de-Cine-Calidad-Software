<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FestivalCineManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Festival_Cine</a> &gt; <a href="index.source.html" class="el_package">es.deusto.server</a> &gt; <span class="el_source">FestivalCineManager.java</span></div><h1>FestivalCineManager.java</h1><pre class="source lang-java linenums">package es.deusto.server;

import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.QueryParam;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Response.Status;

import es.deusto.server.dao.IDAO;
import es.deusto.server.dao.DBManager;
import es.deusto.server.data.*;

import java.util.ArrayList;
import java.util.List;

import java.util.logging.Level;
import java.util.logging.Logger;

/**
 * Este bloque de código provee una API RESTful para establecer una conexión entre la parte cliente y servidora de
 * la aplicación. A su vez, tiene acceso a los diferentes tipos de dato utilizados en la aplicación representados con
 * el patrón de diseño DTO para poder serializarse y transmitirse, además de al DAO para gestionar la base de datos
 * MySQL con DataNucleus.
 * @author Grupo RMBJ
 * @version 3.0
 * @since 1.0
 */
@Path(&quot;/server&quot;)
@Produces(MediaType.APPLICATION_JSON)
public class FestivalCineManager {

<span class="pc" id="L35">	private int cont = 0;</span>
	IDAO dao;
<span class="fc" id="L37">	static Logger logger = Logger.getLogger(FestivalCineManager.class.getName());</span>

	public FestivalCineManager() {
<span class="nc" id="L40">		super();</span>
<span class="nc" id="L41">		dao = new DBManager();</span>
<span class="nc" id="L42">	}</span>

	public FestivalCineManager(IDAO udao) {
<span class="fc" id="L45">		super();</span>
<span class="fc" id="L46">		dao = udao;</span>
<span class="fc" id="L47">	}</span>

	@POST
	@Path(&quot;/registerUser&quot;)
	public Response registerUser(UsuarioDTO usuarioDTOData) {
<span class="fc" id="L52">		logger.info(&quot;Checking whether the UsuarioDTO already exists or not: '&quot; + usuarioDTOData.getLogin() + &quot;'&quot;);</span>
<span class="fc" id="L53">		UsuarioDTO usuarioDTO = null;</span>
		try
		{
<span class="fc" id="L56">			usuarioDTO = dao.retrieveUsuario(usuarioDTOData.getLogin());</span>
		}
<span class="nc" id="L58">		catch (Exception e)</span>
		{
<span class="nc" id="L60">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="fc" id="L61">		}</span>

<span class="fc bfc" id="L63" title="All 2 branches covered.">		if (usuarioDTO != null) {</span>
<span class="fc" id="L64">			logger.info(&quot;The user exists. So, setting new password for UsuarioDTO: &quot; + usuarioDTOData.getLogin());</span>
<span class="fc" id="L65">			usuarioDTO.setPassword(usuarioDTOData.getPassword());</span>
<span class="fc" id="L66">			logger.info(&quot;Password set for UsuarioDTO: &quot; + usuarioDTOData.getLogin());</span>
<span class="fc" id="L67">			dao.updateUsuario(usuarioDTO);</span>
		}
		else {
<span class="fc" id="L70">			logger.info(&quot;Creating UsuarioDTO: &quot; + usuarioDTOData.getLogin());</span>
<span class="fc" id="L71">			usuarioDTO = new UsuarioDTO(usuarioDTOData.getLogin(), usuarioDTOData.getPassword());</span>
<span class="fc" id="L72">			dao.storeUsuario(usuarioDTO);</span>
<span class="fc" id="L73">			logger.info(&quot;UsuarioDTO created: &quot; + usuarioDTOData.getLogin());</span>
		}

<span class="fc" id="L76">		return Response.ok().build();</span>
	}

	@POST
	@Path(&quot;/sayMessage&quot;)
	public Response sayMessage(DirectedMessage directedMessage) {
<span class="fc" id="L82">		logger.info(&quot;Retrieving the user: '&quot; + directedMessage.getUsuarioDTO().getLogin() + &quot;'&quot;);</span>
<span class="fc" id="L83">		UsuarioDTO usuarioDTO = null;</span>
		try
		{
<span class="fc" id="L86">			usuarioDTO = dao.retrieveUsuario(directedMessage.getUsuarioDTO().getLogin());</span>
		}
<span class="nc" id="L88">		catch (Exception e)</span>
		{
<span class="nc" id="L90">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="fc" id="L91">		}</span>

<span class="fc" id="L93">		logger.info(&quot;User retrieved: &quot; + usuarioDTO);</span>
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">		if (usuarioDTO != null) {</span>
<span class="fc" id="L95">			Message message = new Message(directedMessage.getMessage());</span>
<span class="fc" id="L96">			message.setUsuarioDTO(usuarioDTO);</span>
<span class="fc" id="L97">			usuarioDTO.getMessages().add(message);</span>
<span class="fc" id="L98">			dao.updateUsuario(usuarioDTO);</span>
<span class="fc" id="L99">			cont++;</span>
<span class="fc" id="L100">			logger.info(&quot; * Client number: &quot; + cont);</span>
<span class="fc" id="L101">			return Response.ok(directedMessage.getMessage()).build();</span>
		}
		else {
<span class="nc" id="L104">			String m = &quot;Login details supplied for message delivery are not correct&quot;;</span>
<span class="nc" id="L105">			logger.info(m);</span>
<span class="nc" id="L106">			return Response.status(Status.BAD_REQUEST).entity(m).build();</span>
		}
	}

	@GET
	@Path(&quot;/messages&quot;)
	public Response getUserMessages(@QueryParam(&quot;login&quot;) String login) {
<span class="nc" id="L113">		logger.info(&quot;Checking whether the user already exits or not: '&quot; + login + &quot;'&quot;);</span>
<span class="nc" id="L114">		UsuarioDTO usuarioDTO = null;</span>
		try {
<span class="nc" id="L116">			usuarioDTO = dao.retrieveUsuario(login);</span>
<span class="nc" id="L117">		} catch (Exception e) {</span>
<span class="nc" id="L118">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="nc" id="L119">		}</span>

<span class="nc bnc" id="L121" title="All 2 branches missed.">		if (usuarioDTO != null) {</span>
<span class="nc" id="L122">			logger.info(&quot;Returning the messages to the client: &quot; + login);</span>

<span class="nc" id="L124">			MessageList messageList = new MessageList();</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">			for (Message m : usuarioDTO.getMessages()) {</span>
<span class="nc" id="L126">				messageList.addMessage(m);</span>
<span class="nc" id="L127">			}</span>
<span class="nc" id="L128">			return Response.ok(messageList).build();</span>
		} else {
<span class="nc" id="L130">			logger.info(&quot;The user does not exist, no possibility of retrieving messages ...: &quot; + login);</span>
<span class="nc" id="L131">			return Response.status(Status.BAD_REQUEST).entity(&quot;Login details supplied for message delivery &quot; +</span>
<span class="nc" id="L132">					&quot;are not correct&quot;).build();</span>
		}
	}

	@GET
	@Path(&quot;obtainUser&quot;)
	public Response getUser(@QueryParam(&quot;login&quot;) String login, @QueryParam(&quot;pwd&quot;) String pwd) {
<span class="nc" id="L139">		logger.info(&quot;Checking whether the user already exists or not: '&quot; + login + &quot;'&quot;);</span>
<span class="nc" id="L140">		UsuarioDTO usuarioDTO = null;</span>
		try {
<span class="nc" id="L142">			usuarioDTO = dao.retrieveUsuario(login);</span>
<span class="nc" id="L143">		} catch (Exception e) {</span>
<span class="nc" id="L144">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="nc" id="L145">		}</span>

<span class="nc bnc" id="L147" title="All 2 branches missed.">		if (usuarioDTO != null) {</span>
<span class="nc" id="L148">			logger.info(&quot;Returning the user to the client: &quot; + login);</span>
<span class="nc" id="L149">			return Response.ok(usuarioDTO).build();</span>
		}
		else {
<span class="nc" id="L152">			logger.info(&quot;The user does not exist, no possibility of retrieving user ...: &quot; + login);</span>
<span class="nc" id="L153">			return Response.status(Status.BAD_REQUEST).entity(&quot;Login details supplied for user delivery is &quot; +</span>
<span class="nc" id="L154">					&quot;not correct&quot;).build();</span>
		}
	}

	@POST
	@Path(&quot;/registerActor&quot;)
	public Response registerActor(ActorDTO actorDTOData) {
<span class="nc" id="L161">		logger.info(&quot;Checking whether the actor already exists or not: '&quot; + actorDTOData.getNombre() + &quot; &quot;</span>
<span class="nc" id="L162">				+actorDTOData.getApellido() + &quot;'&quot;);</span>
<span class="nc" id="L163">		ActorDTO actorDTO = null;</span>
		try {
<span class="nc" id="L165">			actorDTO = dao.retrieveActor(actorDTOData.getIdentificador());</span>
<span class="nc" id="L166">		} catch (Exception e) {</span>
<span class="nc" id="L167">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="nc" id="L168">		}</span>

<span class="nc bnc" id="L170" title="All 2 branches missed.">		if (actorDTO != null) {</span>
<span class="nc" id="L171">			logger.info(&quot;The actor already exists.&quot;);</span>
		} else {
<span class="nc" id="L173">			logger.info(&quot;Creating actor: &quot; + actorDTOData.getNombre() + &quot; &quot; + actorDTOData.getApellido());</span>
<span class="nc" id="L174">			actorDTO = new ActorDTO(actorDTOData.getIdentificador(), actorDTOData.getNombre(),</span>
<span class="nc" id="L175">					actorDTOData.getApellido(), actorDTOData.getEdad());</span>
<span class="nc" id="L176">			dao.storeActor(actorDTO);</span>
<span class="nc" id="L177">			logger.info(&quot;Actor created: &quot; + actorDTOData.getNombre() + &quot; &quot; + actorDTOData.getApellido() + &quot; ,&quot; +</span>
<span class="nc" id="L178">					&quot;with ID: &quot; + actorDTOData.getIdentificador());</span>
		}
<span class="nc" id="L180">		return Response.ok().build();</span>
	}

	@GET
	@Path(&quot;/obtainActors&quot;)
	public Response getActors() {
<span class="nc" id="L186">		logger.info(&quot;Returning the actors to the client.&quot;);</span>
<span class="nc" id="L187">		ActorList actorList = new ActorList();</span>
<span class="nc" id="L188">		actorList.setActorsDTO(dao.getActors());</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">		if (actorList.getActorsDTO().size()&gt;0){</span>
<span class="nc" id="L190">			return Response.ok(actorList).build();</span>
		}
		else {
<span class="nc" id="L193">			String m = &quot;There is no actor to retrieve ...&quot;;</span>
<span class="nc" id="L194">			logger.info(m);</span>
<span class="nc" id="L195">			return Response.status(Status.BAD_REQUEST).entity(m).build();</span>
		}
	}

	@POST
	@Path(&quot;/updateActor&quot;)
	public Response updateActor(ActorDTO actorDTOData) {
<span class="nc" id="L202">		ActorDTO actorDTO = null;</span>
		try {
<span class="nc" id="L204">			actorDTO = dao.retrieveActor(actorDTOData.getIdentificador());</span>
		}
<span class="nc" id="L206">		catch (Exception e) {</span>
<span class="nc" id="L207">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="nc" id="L208">		}</span>

<span class="nc bnc" id="L210" title="All 2 branches missed.">		if (actorDTO != null) {</span>
<span class="nc" id="L211">			logger.info(&quot;Actor found. Updating the actor: &quot; + actorDTOData.getNombre() + &quot; &quot;</span>
<span class="nc" id="L212">					+ actorDTOData.getApellido());</span>
<span class="nc" id="L213">			dao.updateActor(actorDTO);</span>
<span class="nc" id="L214">			logger.info(&quot;(FestivalCineManager) Actor updated : &quot; + actorDTOData.getNombre() + &quot; &quot;</span>
<span class="nc" id="L215">					+ actorDTOData.getApellido());</span>
		} else {
<span class="nc" id="L217">			logger.info(&quot;The actor wasn't found in the database.&quot;);</span>
		}

<span class="nc" id="L220">		return Response.ok().build();</span>
	}

	@POST
	@Path(&quot;/registerPelicula&quot;)
	public Response registerPelicula(PeliculaDTO peliculaDTOData) {
<span class="nc" id="L226">		logger.info(&quot;Checking whether the pelicula already exists or not: '&quot; + peliculaDTOData.getTitulo());</span>
<span class="nc" id="L227">		PeliculaDTO peliculaDTO = null;</span>
		try {
<span class="nc" id="L229">			peliculaDTO = dao.retrievePelicula(peliculaDTOData.getTitulo());</span>
<span class="nc" id="L230">		} catch (Exception e) {</span>
<span class="nc" id="L231">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="nc" id="L232">		}</span>

<span class="nc bnc" id="L234" title="All 2 branches missed.">		if (peliculaDTO != null) {</span>
<span class="nc" id="L235">			logger.info(&quot;The pelicula already exists.&quot;);</span>
		}
		else {
<span class="nc" id="L238">			logger.info(&quot;Creating pelicula: &quot; + peliculaDTOData.getTitulo());</span>
<span class="nc" id="L239">			peliculaDTO = new PeliculaDTO(peliculaDTOData.getTitulo(), peliculaDTOData.getSinopsis(),</span>
<span class="nc" id="L240">					peliculaDTOData.getGenero(), peliculaDTOData.getDuracion(), peliculaDTOData.getAnyo(),</span>
<span class="nc" id="L241">					peliculaDTOData.getDirector(), peliculaDTOData.getEnlaceTrailer(),</span>
<span class="nc" id="L242">					peliculaDTOData.getValoracionMedia(), peliculaDTOData.getPremios(),</span>
<span class="nc" id="L243">					peliculaDTOData.getComentarios(), peliculaDTOData.getSeccionFestival(),</span>
<span class="nc" id="L244">					peliculaDTOData.getActores(), peliculaDTOData.getURIimagen());</span>
<span class="nc" id="L245">			dao.storePelicula(peliculaDTO);</span>
<span class="nc" id="L246">			logger.info(&quot;Pelicula created: &quot; + peliculaDTOData.getTitulo());</span>
		}
<span class="nc" id="L248">		return Response.ok().build();</span>
	}

	@GET
	@Path(&quot;/obtainPeliculas&quot;)
	public Response getPeliculas() {
<span class="nc" id="L254">		logger.info(&quot;Returning the peliculas to the client&quot;);</span>

<span class="nc" id="L256">		PeliculaList peliculaList = new PeliculaList();</span>
<span class="nc" id="L257">		peliculaList.setPeliculasDTO(dao.getPeliculas());</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">		if (peliculaList.getPeliculasDTO().size()&gt;0){</span>

<span class="nc" id="L260">			return Response.ok(peliculaList).build();</span>
		} else {
<span class="nc" id="L262">			String m = &quot;There is no pelicula to retrieve ...&quot;;</span>
<span class="nc" id="L263">			logger.info(m);</span>
<span class="nc" id="L264">			return Response.status(Status.BAD_REQUEST).entity(m).build();</span>
		}
	}

	@POST
	@Path(&quot;/registerValoracion&quot;)
	public Response registerValoracion(ValoracionDTO valoracionDTOData) throws NullPointerException {
<span class="nc" id="L271">		logger.info(&quot;Checking whether the pelicula to valorate already exists or not: '&quot; +</span>
<span class="nc" id="L272">				valoracionDTOData.getTitulo());</span>
<span class="nc" id="L273">		PeliculaDTO peliculaDTO = null;</span>
<span class="nc" id="L274">		ValoracionDTO valoracionDTO = null;</span>
<span class="nc" id="L275">		double promedio = 0;</span>
<span class="nc" id="L276">		int numValoracionesTitulo = 0;</span>
		try {
<span class="nc" id="L278">			peliculaDTO = dao.retrievePelicula(valoracionDTOData.getTitulo());</span>
<span class="nc" id="L279">		} catch (Exception e) {</span>
<span class="nc" id="L280">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="nc" id="L281">			throw new NullPointerException();</span>
<span class="nc" id="L282">		}</span>

<span class="nc bnc" id="L284" title="All 2 branches missed.">		if (peliculaDTO != null) {</span>
<span class="nc" id="L285">			logger.info(&quot;The pelicula exists. The valoracion will be done.&quot;);</span>
<span class="nc" id="L286">			logger.info(&quot;Valorating pelicula: &quot; + valoracionDTOData.getTitulo());</span>

<span class="nc" id="L288">			ValoracionList myValoracionList = getLocalValoraciones();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">			if (myValoracionList != null) {</span>
<span class="nc" id="L290">				List&lt;ValoracionDTO&gt; valoracionCheck = myValoracionList.getValoracionesDTO();</span>
<span class="nc" id="L291">				List&lt;ValoracionDTO&gt; valoracionTitulo = new ArrayList&lt;ValoracionDTO&gt;();</span>
<span class="nc" id="L292">				double totalValoracionesTitulo = 0;</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">				for (ValoracionDTO aux: valoracionCheck){</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">					if (aux.getTitulo().compareTo(valoracionDTOData.getTitulo())==0){</span>
<span class="nc" id="L295">						valoracionTitulo.add(aux);</span>
<span class="nc" id="L296">						totalValoracionesTitulo += aux.getValoracion();</span>
					}
<span class="nc" id="L298">				}</span>
<span class="nc" id="L299">				int numTotalValoraciones = valoracionCheck.size();</span>
<span class="nc" id="L300">				numValoracionesTitulo = valoracionTitulo.size()+1;</span>
<span class="nc" id="L301">				logger.info(&quot;Saving valoracion: &quot; + (numTotalValoraciones+1));</span>
<span class="nc" id="L302">				valoracionDTO = new ValoracionDTO(numTotalValoraciones+1, valoracionDTOData.getTitulo(),</span>
<span class="nc" id="L303">						valoracionDTOData.getValoracion());</span>
<span class="nc" id="L304">				dao.storeValoracion(valoracionDTO);</span>
<span class="nc" id="L305">				logger.info(&quot;Valoracion created: &quot; + valoracionDTO.getId());</span>

<span class="nc" id="L307">				promedio = (totalValoracionesTitulo+valoracionDTOData.getValoracion())/numValoracionesTitulo;</span>
<span class="nc" id="L308">			}</span>
			else {
<span class="nc" id="L310">				logger.info(&quot;Saving valoracion: &quot; + 1);</span>
<span class="nc" id="L311">				valoracionDTO = new ValoracionDTO(1, valoracionDTOData.getTitulo(),</span>
<span class="nc" id="L312">						valoracionDTOData.getValoracion());</span>
<span class="nc" id="L313">				dao.storeValoracion(valoracionDTO);</span>
<span class="nc" id="L314">				logger.info(&quot;Valoracion created: &quot; + 1);</span>

<span class="nc" id="L316">				promedio = valoracionDTOData.getValoracion();</span>
			}
<span class="nc" id="L318">			peliculaDTO.setNumvaloraciones(numValoracionesTitulo);</span>
<span class="nc" id="L319">			peliculaDTO.setValoracionMedia(promedio);</span>
<span class="nc" id="L320">			dao.updatePelicula(peliculaDTO);</span>
		}

<span class="nc" id="L323">		return Response.ok().build();</span>
	}

	public ValoracionList getLocalValoraciones() {
<span class="nc" id="L327">		logger.info(&quot;Returning the valoraciones&quot;);</span>

<span class="nc" id="L329">		ValoracionList valoracionList = new ValoracionList();</span>
<span class="nc" id="L330">		valoracionList.setValoracionesDTO((dao.getValoraciones()));</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">		if (valoracionList.getValoracionesDTO().size()&gt;0){</span>
<span class="nc" id="L332">			return valoracionList;</span>
		} else {
<span class="nc" id="L334">			logger.info(&quot;There is no valoracion to retrieve ...&quot;);</span>
<span class="nc" id="L335">			return null;</span>
		}
	}

	@POST
	@Path(&quot;/registerComment&quot;)
	public Response registerComment(ComentarioDTO comentarioDTOData) throws NullPointerException {
<span class="nc" id="L342">		logger.info(&quot;Checking whether the pelicula to comment already exists or not: '&quot;</span>
<span class="nc" id="L343">				+ comentarioDTOData.getPelicula().getTitulo());</span>
<span class="nc" id="L344">		PeliculaDTO peliculaDTO = null;</span>
<span class="nc" id="L345">		ComentarioDTO comentarioDTO = null;</span>
		try {
<span class="nc" id="L347">			peliculaDTO = dao.retrievePelicula(comentarioDTOData.getPelicula().getTitulo());</span>
<span class="nc" id="L348">		} catch (Exception e) {</span>
<span class="nc" id="L349">			logger.log(Level.WARNING, &quot;Exception launched: &quot; + e.getMessage());</span>
<span class="nc" id="L350">			throw new NullPointerException();</span>
<span class="nc" id="L351">		}</span>

<span class="nc bnc" id="L353" title="All 2 branches missed.">		if (peliculaDTO != null) {</span>
<span class="nc" id="L354">			logger.info(&quot;The pelicula exists. The comentario will be done.&quot;);</span>
<span class="nc" id="L355">			logger.info(&quot;Commenting pelicula: &quot; + comentarioDTOData.getPelicula().getTitulo());</span>

<span class="nc" id="L357">			ComentarioList myComentarioList = getLocalComentarios();</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">			if (myComentarioList != null) {</span>
<span class="nc" id="L359">				List&lt;ComentarioDTO&gt; comentarioCheck = myComentarioList.getComentariosDTO();</span>
<span class="nc" id="L360">				int numTotalComentarios = comentarioCheck.size();</span>
<span class="nc" id="L361">				logger.info(&quot;Saving comentario &quot; + (numTotalComentarios + 1));</span>
<span class="nc" id="L362">				comentarioDTO = new ComentarioDTO(numTotalComentarios + 1, peliculaDTO,</span>
<span class="nc" id="L363">						comentarioDTOData.getUsuario(), comentarioDTOData.getContenido());</span>

<span class="nc" id="L365">				peliculaDTO.getComentarios().add(comentarioDTO);</span>
<span class="nc" id="L366">				comentarioDTO.setPelicula(peliculaDTO);</span>
<span class="nc" id="L367">				dao.updatePelicula(peliculaDTO);</span>
<span class="nc" id="L368">				return Response.ok().build();</span>
			}
			else {
<span class="nc" id="L371">				comentarioDTO = new ComentarioDTO(1, peliculaDTO, comentarioDTOData.getUsuario(),</span>
<span class="nc" id="L372">						comentarioDTOData.getContenido());</span>
<span class="nc" id="L373">				peliculaDTO.getComentarios().add(comentarioDTO);</span>
<span class="nc" id="L374">				comentarioDTO.setPelicula(peliculaDTO);</span>
<span class="nc" id="L375">				dao.updatePelicula(peliculaDTO);</span>
<span class="nc" id="L376">				return Response.ok().build();</span>
			}
		}
		else {
<span class="nc" id="L380">			return Response.status(Status.BAD_REQUEST).entity(&quot;There is no pelicula to comment ...&quot;).build();</span>
		}
	}

	public ComentarioList getLocalComentarios() {
<span class="nc" id="L385">		logger.info(&quot;Returning the comentarios&quot;);</span>

<span class="nc" id="L387">		ComentarioList comentarioList = new ComentarioList();</span>
<span class="nc" id="L388">		comentarioList.setComentariosDTO((dao.getComentarios()));</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">		if (comentarioList.getComentariosDTO().size()&gt;0){</span>
<span class="nc" id="L390">			return comentarioList;</span>
		} else {
<span class="nc" id="L392">			logger.info(&quot;There is no comentario to retrieve ...&quot;);</span>
<span class="nc" id="L393">			return null;</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>